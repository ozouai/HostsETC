<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>HostsETC</title>
    <meta name="description" content="A GUI based host file editor"/>

    <meta name="viewport" content="width=1000, initial-scale=1.0, maximum-scale=1.0">

    <!-- Loading Bootstrap -->
    <link href="dist/css/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Loading Flat UI -->
    <link href="dist/css/flat-ui.css" rel="stylesheet">
    <link href="docs/assets/css/demo.css" rel="stylesheet">

    <link rel="shortcut icon" href="img/favicon.ico">

    <script type="text/javascript">
        window.nodeRequire = require;
        delete window.require;
        delete window.module;
        delete window.exports;
    </script>

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements. All other JS at the end of file. -->
    <!--[if lt IE 9]>
    <script src="dist/js/vendor/html5shiv.js"></script>
    <script src="dist/js/vendor/respond.min.js"></script>
    <![endif]-->

    <script src="dist/js/vendor/jquery.min.js"></script>
    <script src="dist/js/flat-ui.min.js"></script>
    <script src="docs/assets/js/application.js"></script>
    <style>
        .bootstrap-switch-square.autoCommitSwitchContainer > .bootstrap-switch {
            border: 1px solid #222;
        }
        .row.inverse {
            background-color:#e0e0e0;
        }
        .entryRow {
            padding-top:5px;
            padding-bottom:5px;
        }
    </style>
</head>
<body  style="background-color:#d4d4d4;">
<nav class="navbar navbar-inverse navbar-embossed" role="navigation" style="border-radius:0px;">
    <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-01">
            <span class="sr-only">Toggle navigation</span>
        </button>
        <a class="navbar-brand" href="#">HostsETC</a>
    </div>
    <div class="navbar-right navbar-form">
        <div class="bootstrap-switch-square autoCommitSwitchContainer text-primary">
            Autocommit: &nbsp;&nbsp;&nbsp;<input type="checkbox" checked data-toggle="switch" id="autoCommitSwitch" data-on-text="<span class='fui-check'></span>" data-off-text="<span class='fui-cross'></span>" />
        </div>
    </div>
</nav><!-- /navbar -->
<div class="container" id="lineContainer"  style="background-color:#f3f3f3; padding-top:15px; padding-bottom:50px; border-radius:7px;">
    <div class="row">
        <div class="col-sm-2">
            New Entry
        </div>
        <div class="col-sm-3">
            <input placeholder="Domain" class="form-control" id="domainInput">
        </div>
        <div class="col-sm-3">
            <input placeholder="127.0.0.1" class="form-control" id="ipaddrInput">
        </div>
        <div class="col-sm-3">
            <input placeholder="Comment" class="form-control" id="entryCommentInput">
        </div>
        <div class="col-sm-1">
            <button class="btn btn-primary" id="addEntryButton">Add</button>
        </div>
    </div>
    <hr style="border-color:#8f8f8f;">
    <!--
    <div class="row">
        <div class="col-sm-2 entryActive ">

                <div class="bootstrap-switch-square">
                    <input type="checkbox" checked data-toggle="switch" class="entryActiveSwitch" data-on-text="<span class='fui-check'></span>" data-off-text="<span class='fui-cross'></span>" />
                </div>
        </div>
        <div class="col-sm-3 entryAddr">
            yahoo.com
        </div>
        <div class="col-sm-3 entryIpaddr">
            127.0.0.1
        </div>
        <div class="col-sm-3 entryComment">
            # Comment
        </div>
    </div>-->
</div>


<script type="text/javascript">

    var autoCommit = true;
    function checkEntryInput() {
        if($("#domainInput").val().length == 0) return $("#domainInput").focus();
        if($("#ipaddrInput").val().length == 0) $("#ipaddrInput").val("127.0.0.1");
        addEntryInput();
    }

    function addEntryInput() {
        var addr = $("#domainInput").val();
        var ipaddr = $("#ipaddrInput").val();
        var comment = $("#entryCommentInput").val();
        $("#domainInput").val("");
        $("#ipaddrInput").val("");
        $("#entryCommentInput").val("");
        $.post("http://127.0.0.1:5002/createEntry", {addr:addr, ipaddr:ipaddr, comment:comment}, function(data) {
            createEntry(data.line, addr, ipaddr, comment, true);

        })
    }

    $("#autoCommitSwitch").on("switchChange.bootstrapSwitch", function(ev, state) {
        autoCommit = state;
    })

    var altRow = false;
    function createEntry(line, addr, ipaddr, comment, active) {
        var row = createEntryRow();
        if(altRow) $(row).addClass("inverse");
        altRow = !altRow;
        row.find(".entryAddr").html(addr);
        row.find(".entryIpaddr").html(ipaddr);
        row.find(".entryComment").html("# " + comment);
        if(active) row.find(".entryActiveSwitch").attr("checked", "checked");
        else row.find(".entryActiveSwitch").removeAttr("checked");
        row.find(".entryActiveSwitch").first().bootstrapSwitch();
        row.find(".entryActiveSwitch").first().on("switchChange.bootstrapSwitch", function(ev, state) {
            $.get("http://127.0.0.1:5002/editLine/"+line+"/active/"+state, function() {
                if(autoCommit) {
                    $.get("http://127.0.0.1:5002/commit");
                }
            });
        });
        var addrEditing = false;
        row.find(".entryAddr").on("dblclick", function() {
            if(addrEditing) return;
            addrEditing = true;
            $(this).attr("contenteditable", true);
            $(this).focus();
            $(this).one("blur", function() {
                $(this).removeAttr("contenteditable");
                $.get("http://127.0.0.1:5002/editLine/"+line+"/addr/"+$(this).html(), function() {
                    if(autoCommit) {
                        $.get("http://127.0.0.1:5002/commit");
                    }
                    addrEditing = false;
                });
            })
        });
        row.find(".entryAddr").on("keydown", function(e) {
            if(!addrEditing)return;
            if(e.keyCode == 13) {
                e.preventDefault();
                $(this).blur();
            }
        })
        var ipaddrEditing = false;
        row.find(".entryIpaddr").on("dblclick", function() {
            if(ipaddrEditing) return;
            ipaddrEditing = true;
            $(this).attr("contenteditable", true);
            $(this).focus();
            $(this).one("blur", function() {
                $(this).removeAttr("contenteditable");
                $.get("http://127.0.0.1:5002/editLine/"+line+"/ipaddr/"+$(this).html(), function() {
                    if(autoCommit) {
                        $.get("http://127.0.0.1:5002/commit");
                    }
                    ipaddrEditing = false;
                });
            })
        });
        row.find(".entryIpaddr").on("keydown", function(e) {
            if(!ipaddrEditing)return;
            if(e.keyCode == 13) {
                e.preventDefault();
                $(this).blur();
            }
        })
        var commentEditing = false;
        row.find(".entryComment").on("dblclick", function() {
            if(commentEditing) return;
            commentEditing = true;
            var $t = $(this);
            $(this).attr("contenteditable", true);
            $t.focus();
            while($(this).html().charAt(0) == "#" || $(this).html().charAt(0) == " ") {
                $(this).html($(this).html().substr(1));
            }
            $(this).one("blur", function() {
                $(this).removeAttr("contenteditable");
                $.get("http://127.0.0.1:5002/editLine/"+line+"/comment/"+$(this).html(), function() {
                    if(autoCommit) {
                        $.get("http://127.0.0.1:5002/commit");
                    }
                    $t.html("# "+ $t.html());
                    commentEditing = false;
                });
            })
        });
        row.find(".entryComment").on("keydown", function(e) {
            if(!commentEditing)return;
            if(e.keyCode == 13) {
                e.preventDefault();
                $(this).blur();
            }
        })
        row.attr("data-line", line);
        $("#lineContainer").append(row);
    }

    function createEntryRow() {
        return $("<div class=\"row entryRow\"><div class=\"col-sm-2 entryActive \"><div class=\"bootstrap-switch-square\"><input type=\"checkbox\" checked data-toggle=\"switch\" class=\"entryActiveSwitch\" data-on-text=\"<span class='fui-check'></span>\" data-off-text=\"<span class='fui-cross'></span>\" /></div></div><div class=\"col-sm-3 entryAddr\">yahoo.com</div><div class=\"col-sm-3 entryIpaddr\">127.0.0.1</div><div class=\"col-sm-3 entryComment\"># Comment</div></div>");
    }

    $.get("http://127.0.0.1:5002/hostsJSON", function(data) {
        for(var i=0; i<data.length; i++) {
            var line = data[i];
            if(line.type != "address") continue;
            if(line.locked) continue;
            createEntry(i, line.addr, line.ipaddr, line.comment, line.active);
        }
    })

    $("#domainInput").on("keyup", function (ev) {
        if(ev.keyCode == 13) checkEntryInput();
    });
    $("#ipaddrInput").on("keyup", function(ev) {
        if(ev.keyCode == 13) checkEntryInput();
    });
    $("#entryCommentInput").on("keyup", function(ev) {
        if(ev.keyCode == 13) checkEntryInput();
    });



</script>
</body>
</html>